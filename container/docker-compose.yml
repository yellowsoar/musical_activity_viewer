services:
  backend:
    container_name: mav_backend
    image: ghcr.io/yellowsoar/musical_activity_viewer:latest
    ports:
      - 0.0.0.0:8000:8000
      - 0.0.0.0:8888:80
    env_file:
      - ../.env
    depends_on:
      - mongodb

  mongodb:
    container_name: mav_mongodb
    image: bitnami/mongodb:4.2.21
    # AVX issue
    # https://github.com/docker-library/mongo/issues/485#issuecomment-891991814
    restart: always
    ports:
      - 27017:27017
    command: mongod --dbpath /tmp

  # https://hub.docker.com/_/mongo-express
  mongo-express:
    container_name: mav_express
    image: mongo-express
    restart: always
    ports:
      - 8081:8081
    env_file:
      - ../.env
    depends_on:
      - mongodb
